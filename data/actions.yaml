schema_version: 1

# Tier convention:
# 0 = fail/partial, 1 = normal, 2 = good, 3 = great
# The engine will compute a tier deterministically from skill + context + items + rng_seed.

actions:
  - id: move
    display_name: "Move"
    description: "Move to a connected space."
    category: movement
    time_minutes: 15
    parameters:
      - name: target_space
        type: space_id
        required: true

    requires:
      location:
        connected_to_param: target_space

    modifiers:
      primary_skill: reflexivity
      secondary_skills: {}

    outcomes:
      1:
        deltas:
          needs:
            fatigue: 2

  - id: repair_item
    display_name: "Repair item"
    description: "Repair a specific item you can reach."
    category: maintenance
    time_minutes: 60
    parameters:
      - name: item_ref
        type: item_ref
        required: true
        constraints:
          reachable: true

    requires:
      skills_min:
        maintenance: 0
    modifiers:
      primary_skill: maintenance
      secondary_skills: {}
      tier_floor: 0   # opt-in: this action can genuinely fail / partially succeed
    dynamic:
      cost_formula:
        base_per_damage_pence: 10
        min_cost_pence: 50
        skill_discount_per_point: 2
      restoration_formula:
        base: 30
        per_skill_point: 0.5
    outcomes:
      0: { events: [{ id: "action.failed", params: { reason: "repair_failed" } }], deltas: { needs: { stress: 2, mood: -1 } } }
      1: { events: [{ id: "action.repair_item", params: {} }], deltas: { skills_xp: { maintenance: 2.0 } } }
      2: { events: [{ id: "action.repair_item", params: { quality: "good" } }], deltas: { skills_xp: { maintenance: 2.3 } } }
      3: { events: [{ id: "action.repair_item", params: { quality: "great" } }], deltas: { skills_xp: { maintenance: 2.7 } } }

  - id: pick_up_item
    display_name: "Pick up item"
    description: "Move an item from the floor into inventory."
    category: inventory
    time_minutes: 5
    parameters:
      - name: item_ref
        type: item_ref
        required: true
        constraints:
          reachable: true

    requires:
      location: {}
    outcomes:
      1: { events: [{ id: "action.pick_up_item", params: {} }] }

  - id: drop_item
    display_name: "Drop item"
    description: "Drop an item from inventory onto the floor."
    category: inventory
    time_minutes: 2
    parameters:
      - name: item_ref
        type: item_ref
        required: true
        constraints:
          in_inventory: true
    outcomes:
      1: { events: [{ id: "action.drop_item", params: {} }] }

  - id: cook_basic_meal
    display_name: "Cook basic meal"
    description: "Cook a simple meal. Better tools and nutrition skill improve results."
    category: survival
    time_minutes: 60

    # "Hard" requirements: must be satisfied or action is invalid.
    requires:
      money_pence: 300
      location:
        any_space_tags: ["kitchen", "room"]   # allow cooking in room if you have a portable tool
      utilities:
        all_true: ["power"]                  # power must be on for most cooking devices
      items:
        any_provides: ["heat_source"]        # e.g., kettle, stove, microwave
      skills_min:
        nutrition: 0                         # allow at any level; skill affects tier

    # "Soft" modifiers: affect tier and deltas but do not block the action.
    modifiers:
      primary_skill: nutrition
      secondary_skills:
        resource_management: 0.20
      traits:
        creativity: 0.15
        frugality: 0.10
      item_provides_weights:
        heat_source: 0.70
        cook_surface: 0.30
      tier_floor: 0   # opt-in: cooking can fail when requirements are met

    # Costs/consumption on success tiers (or on all tiers if specified).
    consumes:
      money_pence: 300
      item_durability:
        provides: "heat_source"
        amount: 4

    outcomes:
      0:
        events: [{ id: "action.failed", params: { reason: "meal_failed" } }]
        deltas:
          needs:
            stress: 2
            mood: -1
      1:
        events: [{ id: "action.cook_basic_meal", params: { quality: "normal" } }]
        deltas:
          needs:
            hunger: -35
            mood: 3
          skills_xp:
            nutrition: 1.5
      2:
        events: [{ id: "action.cook_basic_meal", params: { quality: "good" } }]
        deltas:
          needs:
            hunger: -45
            mood: 5
            stress: -2
          skills_xp:
            nutrition: 1.8
      3:
        events: [{ id: "action.cook_basic_meal", params: { quality: "great" } }]
        deltas:
          needs:
            hunger: -55
            mood: 7
            stress: -4
          skills_xp:
            nutrition: 2.2
        grants:
          items:
            - { item_id: "leftovers_portion", quantity: 1, placed_in: "inventory" }

  - id: meal_prep
    display_name: "Meal prep"
    description: "Batch cook portions. Requires containers; better cooking setup yields more."
    category: survival
    time_minutes: 120
    requires:
      money_pence: 600
      location:
        any_space_tags: ["kitchen"]
      utilities:
        all_true: ["power"]
      items:
        all_provides: ["cook_surface"]
        has_item_ids: ["meal_prep_containers"]
      skills_min:
        nutrition: 5
    modifiers:
      primary_skill: nutrition
      secondary_skills:
        resource_management: 0.35
      tier_floor: 0   # opt-in: meal prep can fail when requirements are met
    consumes:
      money_pence: 600
      item_durability:
        provides: "cook_surface"
        amount: 5
    outcomes:
      0:
        events: [{ id: "action.failed", params: { reason: "prep_failed" } }]
        deltas:
          needs:
            stress: 3
            mood: -2
      1:
        events: [{ id: "action.meal_prep", params: { portions: 3 } }]
        deltas:
          needs:
            hunger: -20
            mood: 2
          skills_xp:
            nutrition: 2.0
            resource_management: 0.6
        grants:
          items: [{ item_id: "meal_portion", quantity: 3, placed_in: "inventory" }]
      2:
        events: [{ id: "action.meal_prep", params: { portions: 4 } }]
        deltas:
          needs:
            hunger: -25
            mood: 3
            stress: -1
          skills_xp:
            nutrition: 2.3
            resource_management: 0.8
        grants:
          items: [{ item_id: "meal_portion", quantity: 4, placed_in: "inventory" }]
      3:
        events: [{ id: "action.meal_prep", params: { portions: 5 } }]
        deltas:
          needs:
            hunger: -30
            mood: 4
            stress: -2
          skills_xp:
            nutrition: 2.7
            resource_management: 1.0
        grants:
          items: [{ item_id: "meal_portion", quantity: 5, placed_in: "inventory" }]

  - id: eat_meal_portion
    display_name: "Eat meal portion"
    description: "Eat a prepared portion."
    category: survival
    time_minutes: 15
    requires:
      items:
        has_item_ids: ["meal_portion"]
    consumes:
      inventory_items:
        - { item_id: "meal_portion", quantity: 1 }
    modifiers:
      primary_skill: nutrition
      secondary_skills: {}
    outcomes:
      1:
        events: [{ id: "action.eat_meal_portion", params: {} }]
        deltas:
          needs:
            hunger: -40
            mood: 2
          skills_xp:
            nutrition: 0.3
      2:
        events: [{ id: "action.eat_meal_portion", params: { bonus: "balanced" } }]
        deltas:
          needs:
            hunger: -45
            mood: 3
            stress: -1
          skills_xp:
            nutrition: 0.4
      3:
        events: [{ id: "action.eat_meal_portion", params: { bonus: "great" } }]
        deltas:
          needs:
            hunger: -50
            mood: 4
            stress: -2
          skills_xp:
            nutrition: 0.5

  - id: shower
    display_name: "Shower"
    description: "Clean up. Requires a shower fixture and water."
    category: survival
    time_minutes: 25
    requires:
      location:
        any_space_tags: ["bathroom"]
        requires_fixture: "shower"
      utilities:
        all_true: ["water"]
    modifiers:
      primary_skill: maintenance
      secondary_skills: {}
    outcomes:
      1:
        events: [{ id: "action.shower", params: {} }]
        deltas:
          needs:
            hygiene: -40
            mood: 5
          skills_xp:
            maintenance: 0.2
      2:
        events: [{ id: "action.shower", params: { bonus: "refreshing" } }]
        deltas:
          needs:
            hygiene: -45
            mood: 6
            stress: -1
          skills_xp:
            maintenance: 0.3
      3:
        events: [{ id: "action.shower", params: { bonus: "very_refreshing" } }]
        deltas:
          needs:
            hygiene: -50
            mood: 7
            stress: -2
          skills_xp:
            maintenance: 0.4

  - id: clean_room
    display_name: "Clean room"
    description: "Tidy up. Cleaning kit improves efficiency."
    category: maintenance
    time_minutes: 45
    requires:
      location:
        any_space_tags: ["room"]
    modifiers:
      primary_skill: maintenance
      secondary_skills:
        resource_management: 0.15
      item_provides_weights:
        cleaning_kit: 1.0
    consumes:
      item_durability:
        provides: "cleaning_kit"
        amount: 2
    outcomes:
      1:
        events: [{ id: "action.clean_room", params: {} }]
        deltas:
          needs:
            hygiene: -5
            mood: 8
            stress: -3
          skills_xp:
            maintenance: 2.0
      2:
        events: [{ id: "action.clean_room", params: { quality: "good" } }]
        deltas:
          needs:
            hygiene: -7
            mood: 10
            stress: -5
          skills_xp:
            maintenance: 2.3
      3:
        events: [{ id: "action.clean_room", params: { quality: "great" } }]
        deltas:
          needs:
            hygiene: -9
            mood: 12
            stress: -7
          skills_xp:
            maintenance: 2.7

  - id: deep_clean
    display_name: "Deep clean"
    description: "A thorough clean. Takes time but reduces stress and illness risk (future)."
    category: maintenance
    time_minutes: 120
    requires:
      location:
        any_space_tags: ["room"]
      items:
        any_provides: ["cleaning_kit"]
      skills_min:
        maintenance: 10
    modifiers:
      primary_skill: maintenance
      secondary_skills:
        resource_management: 0.20
      tier_floor: 0   # opt-in: requires and consumes cleaning_kit
    consumes:
      item_durability:
        provides: "cleaning_kit"
        amount: 5
    outcomes:
      0:
        events: [{ id: "action.failed", params: { reason: "deep_clean_failed" } }]
        deltas:
          needs:
            stress: 2
            mood: -1
            fatigue: 4
      1:
        events: [{ id: "action.deep_clean", params: {} }]
        deltas:
          needs:
            mood: 12
            stress: -10
            fatigue: 8
          skills_xp:
            maintenance: 3.0
      2:
        events: [{ id: "action.deep_clean", params: { quality: "good" } }]
        deltas:
          needs:
            mood: 14
            stress: -12
            fatigue: 7
          skills_xp:
            maintenance: 3.3
      3:
        events: [{ id: "action.deep_clean", params: { quality: "great" } }]
        deltas:
          needs:
            mood: 16
            stress: -14
            fatigue: 6
          skills_xp:
            maintenance: 3.7

  - id: budget_review
    display_name: "Budget review"
    description: "Plan spending. Reduces stress and improves future bill negotiation chances."
    category: other
    time_minutes: 45
    requires:
      items:
        any_provides: ["workspace"]    # desks provide this
    modifiers:
      primary_skill: resource_management
      secondary_skills: {}
    outcomes:
      1:
        events: [{ id: "action.budget_review", params: { insight: "basic" } }]
        deltas:
          needs:
            stress: -6
            mood: 1
          skills_xp:
            resource_management: 1.2
      2:
        events: [{ id: "action.budget_review", params: { insight: "good" } }]
        deltas:
          needs:
            stress: -8
            mood: 2
          skills_xp:
            resource_management: 1.5
      3:
        events: [{ id: "action.budget_review", params: { insight: "great" } }]
        deltas:
          needs:
            stress: -10
            mood: 3
          skills_xp:
            resource_management: 1.8

  - id: negotiate_utilities
    display_name: "Negotiate utilities"
    description: "Attempt to reduce your utilities cost next time you pay."
    category: other
    time_minutes: 30
    requires:
      skills_min:
        resource_management: 5
        persuasion: 3
    modifiers:
      primary_skill: persuasion
      secondary_skills:
        resource_management: 0.40
    outcomes:
      0:
        events: [{ id: "action.negotiate_utilities", params: { result: "fail" } }]
        deltas:
          needs:
            stress: 2
      1:
        events: [{ id: "action.negotiate_utilities", params: { result: "small_discount" } }]
        deltas:
          skills_xp:
            persuasion: 1.0
            resource_management: 0.4
          flags:
            utilities_discount_pence: 100
      2:
        events: [{ id: "action.negotiate_utilities", params: { result: "discount" } }]
        deltas:
          skills_xp:
            persuasion: 1.2
            resource_management: 0.5
          flags:
            utilities_discount_pence: 200
      3:
        events: [{ id: "action.negotiate_utilities", params: { result: "big_discount" } }]
        deltas:
          skills_xp:
            persuasion: 1.4
            resource_management: 0.6
          flags:
            utilities_discount_pence: 350

  - id: study_focused
    display_name: "Focused study"
    description: "A concentrated study session. Better ergonomics reduces fatigue."
    category: survival
    time_minutes: 90
    requires:
      items:
        any_provides: ["workspace"]
      skills_min:
        ergonomics: 0
    modifiers:
      primary_skill: ergonomics
      secondary_skills:
        analysis: 0.30
    outcomes:
      1:
        events: [{ id: "action.study_focused", params: { intensity: "normal" } }]
        deltas:
          needs:
            fatigue: 14
            mood: -1
          skills_xp:
            ergonomics: 1.0
            analysis: 0.6
      2:
        events: [{ id: "action.study_focused", params: { intensity: "good" } }]
        deltas:
          needs:
            fatigue: 12
            mood: 0
          skills_xp:
            ergonomics: 1.2
            analysis: 0.7
      3:
        events: [{ id: "action.study_focused", params: { intensity: "great" } }]
        deltas:
          needs:
            fatigue: 10
            mood: 1
          skills_xp:
            ergonomics: 1.4
            analysis: 0.8

  - id: work
    display_name: "Work"
    description: "Work your current job. Pay and skills depend on the job."
    category: work
    time_minutes: 240
    requires:
      items:
        any_provides: ["workspace"]
    modifiers:
      primary_skill: technical_literacy
      secondary_skills: {}
      traits:
        confidence: 0.20
        discipline: 0.15
        fitness: 0.10
      item_provides_weights:
        workspace: 1.0
      tier_floor: 0   # opt-in: requires and consumes workspace
    consumes:
      item_durability:
        provides: "workspace"
        amount: 3
    outcomes:
      0:
        events: [{ id: "action.failed", params: { reason: "work_failed" } }]
        deltas:
          needs:
            mood: -4
            stress: 3
      1:
        events: [{ id: "action.work", params: {} }]
        deltas:
          needs:
            mood: -2
      2:
        events: [{ id: "action.work", params: { quality: "good" } }]
        deltas:
          needs:
            mood: -1
      3:
        events: [{ id: "action.work", params: { quality: "great" } }]
        deltas:
          needs:
            mood: 0

  - id: study
    display_name: "Study"
    description: "Study to improve focus skill. Better desk reduces fatigue."
    category: work
    time_minutes: 90
    requires:
      items:
        any_provides: ["workspace"]
    modifiers:
      primary_skill: focus
      secondary_skills:
        ergonomics: 0.20
      traits:
        discipline: 0.10
      item_provides_weights:
        workspace: 1.0
      tier_floor: 0   # opt-in: requires and consumes workspace
    consumes:
      item_durability:
        provides: "workspace"
        amount: 2
    outcomes:
      0:
        events: [{ id: "action.failed", params: { reason: "study_failed" } }]
        deltas:
          needs:
            fatigue: 8
            mood: -2
            stress: 2
      1:
        events: [{ id: "action.study", params: {} }]
        deltas:
          needs:
            fatigue: 10
            mood: 1
          skills_xp:
            focus: 3.0
      2:
        events: [{ id: "action.study", params: { quality: "good" } }]
        deltas:
          needs:
            fatigue: 8
            mood: 2
          skills_xp:
            focus: 3.5
      3:
        events: [{ id: "action.study", params: { quality: "great" } }]
        deltas:
          needs:
            fatigue: 6
            mood: 3
          skills_xp:
            focus: 4.0

  - id: sleep
    display_name: "Sleep"
    description: "Rest to recover fatigue. Better bed improves recovery."
    category: survival
    time_minutes: 480
    requires:
      items:
        any_provides: ["sleeping_surface"]
    modifiers:
      primary_skill: introspection
      secondary_skills: {}
      traits:
        fitness: 0.20
      item_provides_weights:
        sleeping_surface: 1.0
      tier_floor: 0   # opt-in: requires and consumes sleeping_surface
    consumes:
      item_durability:
        provides: "sleeping_surface"
        amount: 2
    outcomes:
      0:
        events: [{ id: "action.failed", params: { reason: "poor_sleep" } }]
        deltas:
          needs:
            fatigue: -15
            mood: -1
      1:
        events: [{ id: "action.sleep", params: {} }]
        deltas:
          needs:
            fatigue: -35
            mood: 3
      2:
        events: [{ id: "action.sleep", params: { quality: "good" } }]
        deltas:
          needs:
            fatigue: -42
            mood: 4
            stress: -2
      3:
        events: [{ id: "action.sleep", params: { quality: "great" } }]
        deltas:
          needs:
            fatigue: -50
            mood: 5
            stress: -4

  - id: eat_charity_rice
    display_name: "Eat charity rice"
    description: "Eat free rice to reduce hunger. Not very satisfying."
    category: survival
    time_minutes: 20
    requires: {}
    modifiers:
      primary_skill: nutrition
      secondary_skills: {}
    outcomes:
      1:
        events: [{ id: "food.eat", params: { meal_id: "charity_rice" } }]
        deltas:
          needs:
            hunger: -25
            mood: -1
          skills_xp:
            nutrition: 0.2
      2:
        events: [{ id: "food.eat", params: { meal_id: "charity_rice", quality: "good" } }]
        deltas:
          needs:
            hunger: -30
            mood: 0
          skills_xp:
            nutrition: 0.3
      3:
        events: [{ id: "food.eat", params: { meal_id: "charity_rice", quality: "great" } }]
        deltas:
          needs:
            hunger: -35
            mood: 1
          skills_xp:
            nutrition: 0.4

  - id: pay_utilities
    display_name: "Pay utilities"
    description: "Pay utilities bill to keep services active. Better resource management reduces cost."
    category: maintenance
    time_minutes: 15
    requires:
      money_pence: 2000
    modifiers:
      primary_skill: resource_management
      secondary_skills: {}
      traits:
        frugality: 0.15
    consumes:
      money_pence: 2000
    outcomes:
      1:
        events: [{ id: "bills.paid", params: {} }]
        deltas:
          skills_xp:
            resource_management: 1.0
      2:
        events: [{ id: "bills.paid", params: { quality: "good" } }]
        deltas:
          needs:
            stress: -1
          skills_xp:
            resource_management: 1.2
      3:
        events: [{ id: "bills.paid", params: { quality: "great" } }]
        deltas:
          needs:
            stress: -2
            mood: 1
          skills_xp:
            resource_management: 1.5

  - id: skip_utilities
    display_name: "Skip utilities"
    description: "Skip paying utilities. Services will be cut off."
    category: maintenance
    time_minutes: 1
    requires: {}
    outcomes:
      1:
        events: [{ id: "bills.skipped", params: {} }]
        deltas: {}

  - id: exercise
    display_name: "Exercise"
    description: "Exercise to improve mood and reduce stress. Fitness reduces fatigue cost."
    category: health
    time_minutes: 60
    requires: {}
    modifiers:
      primary_skill: reflexivity
      secondary_skills: {}
      traits:
        fitness: 0.25
    outcomes:
      1:
        events: [{ id: "action.exercise", params: {} }]
        deltas:
          needs:
            fatigue: 20
            hunger: 5
            mood: 10
            stress: -5
          skills_xp:
            reflexivity: 2.5
      2:
        events: [{ id: "action.exercise", params: { quality: "good" } }]
        deltas:
          needs:
            fatigue: 16
            hunger: 5
            mood: 12
            stress: -6
          skills_xp:
            reflexivity: 2.8
      3:
        events: [{ id: "action.exercise", params: { quality: "great" } }]
        deltas:
          needs:
            fatigue: 12
            hunger: 5
            mood: 15
            stress: -8
          skills_xp:
            reflexivity: 3.2

  - id: rest
    display_name: "Rest and recover"
    description: "Rest to recover from illness and injury. Stoicism helps with stress."
    category: health
    time_minutes: 120
    requires: {}
    modifiers:
      primary_skill: introspection
      secondary_skills: {}
      traits:
        stoicism: 0.20
    outcomes:
      1:
        events: [{ id: "action.rest", params: {} }]
        deltas:
          needs:
            illness: -10
            injury: -5
            fatigue: -10
            stress: -5
            mood: 3
          skills_xp:
            introspection: 0.5
      2:
        events: [{ id: "action.rest", params: { quality: "good" } }]
        deltas:
          needs:
            illness: -12
            injury: -6
            fatigue: -12
            stress: -7
            mood: 4
          skills_xp:
            introspection: 0.7
      3:
        events: [{ id: "action.rest", params: { quality: "great" } }]
        deltas:
          needs:
            illness: -15
            injury: -8
            fatigue: -15
            stress: -10
            mood: 5
          skills_xp:
            introspection: 1.0

  - id: visit_doctor
    display_name: "Visit doctor"
    description: "Visit the doctor for professional medical treatment."
    category: health
    time_minutes: 90
    requires:
      money_pence: 5000
    consumes:
      money_pence: 5000
    outcomes:
      1:
        events: [{ id: "action.visit_doctor", params: {} }]
        deltas:
          needs:
            illness: -40
            injury: -20
            fatigue: 5
            mood: 5
      2:
        events: [{ id: "action.visit_doctor", params: { quality: "good" } }]
        deltas:
          needs:
            illness: -45
            injury: -22
            fatigue: 4
            mood: 6
      3:
        events: [{ id: "action.visit_doctor", params: { quality: "great" } }]
        deltas:
          needs:
            illness: -50
            injury: -25
            fatigue: 3
            mood: 7

  - id: purchase_item
    display_name: "Purchase item"
    description: "Buy an item from the shop."
    category: shopping
    time_minutes: 30
    parameters:
      - name: item_id
        type: string
        required: true
    requires:
      skills_min:
        resource_management: 0
    modifiers:
      primary_skill: resource_management
      secondary_skills: {}
    outcomes:
      1:
        events: [{ id: "shopping.purchase", params: {} }]
        deltas:
          skills_xp:
            resource_management: 0.5
      2:
        events: [{ id: "shopping.purchase", params: { quality: "good" } }]
        deltas:
          skills_xp:
            resource_management: 0.6
      3:
        events: [{ id: "shopping.purchase", params: { quality: "great" } }]
        deltas:
          skills_xp:
            resource_management: 0.7

  - id: sell_item
    display_name: "Sell item"
    description: "Sell an item you own."
    category: shopping
    time_minutes: 20
    parameters:
      - name: item_id
        type: string
        required: true
    requires:
      skills_min:
        resource_management: 0
    modifiers:
      primary_skill: resource_management
      secondary_skills: {}
      traits:
        frugality: 0.10
    outcomes:
      1:
        events: [{ id: "shopping.sell", params: {} }]
        deltas:
          skills_xp:
            resource_management: 0.3
      2:
        events: [{ id: "shopping.sell", params: { quality: "good" } }]
        deltas:
          skills_xp:
            resource_management: 0.4
      3:
        events: [{ id: "shopping.sell", params: { quality: "great" } }]
        deltas:
          skills_xp:
            resource_management: 0.5

  - id: discard_item
    display_name: "Discard item"
    description: "Throw away an item you no longer need."
    category: shopping
    time_minutes: 5
    parameters:
      - name: item_id
        type: string
        required: true
    outcomes:
      1:
        events: [{ id: "shopping.discard", params: {} }]

  - id: apply_job
    display_name: "Apply for job"
    description: "Apply for a new job."
    category: work
    time_minutes: 60
    parameters:
      - name: job_id
        type: string
        required: true
    requires:
      skills_min:
        presence: 0
    modifiers:
      primary_skill: presence
      secondary_skills:
        articulation: 0.30
        persuasion: 0.20
      traits:
        confidence: 0.20
    outcomes:
      1:
        events: [{ id: "job.application_accepted", params: {} }]
        deltas:
          skills_xp:
            presence: 1.0
            articulation: 0.5
      2:
        events: [{ id: "job.application_accepted", params: { quality: "good" } }]
        deltas:
          skills_xp:
            presence: 1.2
            articulation: 0.6
      3:
        events: [{ id: "job.application_accepted", params: { quality: "great" } }]
        deltas:
          skills_xp:
            presence: 1.5
            articulation: 0.8
